<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<!--    <link rel="stylesheet" href="/resources/demos/style.css">-->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- 아래의 naver 키를 넣으면 됩니다. -->
<!--datepicker-->
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- Moment Js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <!-- Lightpick CSS -->
<link rel="stylesheet" href="/static/css/Lightpick.css">

<!-- Lightpick JS -->
<script src="/static/js/lightpick.js"></script>
</head>
<body>
<div id="map" style="width:100%;height:400px;"></div>
<div id="check"> HELLO</div>
<div id="result"> HELLO</div>
<p>Date: <input type="text" id="startdate" class="form-control form-control-sm"/><input type="text" id="enddate" class="form-control form-control-sm"/></p>
<input type="button" name="range" id="range" value="조회" class="btn btn-success"/>
<script>
    var starttime = "";
    var endtime= "";
    var picker = new Lightpick({
        field: document.getElementById('startdate'),
        secondField: document.getElementById('enddate'),
        singleDate: false,
        onSelect: function(start, end){
            var str = '';
            str += start ? start.format('Do MMMM YYYY') + ' to ' : '';
            str += end ? end.format('Do MMMM YYYY') : '...';
            document.getElementById('result').innerHTML = str;
            starttime = start.format('YYYY-MM-DD');
            endtime = end.format('YYYY-MM-DD');
            console.log("start: " + starttime);
            console.log("end: " + endtime);
        }
    });
     $("#range").click(function (){
            console.log("start: " + starttime);
            console.log("end: " + endtime);
            if(starttime != '' && endtime != '') {
                if(starttime < endtime) {
                    $.ajax({
                        type : 'POST',
                        url : '/item_request',
                        data : {
                            fromdate:starttime,
                            todate:endtime
                        },
                        dataType : 'text',
                        success : function(result){
                                alert("result = "+ result);
                        },
                        error : function(xtr,status,error){
                                alert(xtr +":"+status+":"+error);
                        }
                     });
                }else {
                    alert("Please Check the Date");
                }
            } else {
                alert("Please Select the Date");
            }
        });
//////////////////////////////////
var HOME_PATH = window.HOME_PATH || '.';
var MARKER_SPRITE_POSITION = {
        "당진수상 태양광": [37.050753, 126.510299],
        "당진자재창고태양광": [37.050753, 126.510299],
        "당진태양광": [37.050753, 126.510299],
        "울산태양광": [35.477651, 129.380778]
    };

var map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(35.477651, 129.38077),
    zoom: 10
});

var bounds = map.getBounds(),
    southWest = bounds.getSW(),
    northEast = bounds.getNE(),
    lngSpan = northEast.lng() - southWest.lng(),
    latSpan = northEast.lat() - southWest.lat();

var markers = [],
    infoWindows = [];

for (var key in MARKER_SPRITE_POSITION) {

    var position = new naver.maps.LatLng(MARKER_SPRITE_POSITION[key][0],MARKER_SPRITE_POSITION[key][1]);

    var marker = new naver.maps.Marker({
        map: map,
        position: position,
        title: key,
        icon: {
            url: HOME_PATH +'/img/example/sp_pins_spot_v3.png',
            size: new naver.maps.Size(24, 37),
            anchor: new naver.maps.Point(12, 37),
            origin: new naver.maps.Point(MARKER_SPRITE_POSITION[key][0], MARKER_SPRITE_POSITION[key][1])
        },
        zIndex: 100
    });

    var infoWindow = new naver.maps.InfoWindow({
        content: '<div style="width:150px;text-align:center;padding:10px;">This is <b>"'+ key +'"</b>.</div>'
    });

    markers.push(marker);
    infoWindows.push(infoWindow);
};

naver.maps.Event.addListener(map, 'idle', function() {
    updateMarkers(map, markers);
});

function updateMarkers(map, markers) {

    var mapBounds = map.getBounds();
    var marker, position;

    for (var i = 0; i < markers.length; i++) {

        marker = markers[i]
        position = marker.getPosition();

        if (mapBounds.hasLatLng(position)) {
            showMarker(map, marker);
        } else {
            hideMarker(map, marker);
        }
    }
}

function showMarker(map, marker) {

    if (marker.setMap()) return;
    marker.setMap(map);
}

function hideMarker(map, marker) {

    if (!marker.setMap()) return;
    marker.setMap(null);
}

// 해당 마커의 인덱스를 seq라는 클로저 변수로 저장하는 이벤트 핸들러를 반환합니다.
function getClickHandler(seq) {
    return function(e) {
        var marker = markers[seq],
            infoWindow = infoWindows[seq];

        if (infoWindow.getMap()) {
            infoWindow.close();
        } else {
            infoWindow.open(map, marker);
            console.log(marker);
            $("#check").text(marker.title);
        }
    }
}

for (var i=0, ii=markers.length; i<ii; i++) {
    naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i));
}
</script>
</body>
</html>