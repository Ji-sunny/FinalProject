<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sun</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- single daterangepicker -->
    <!-- litepicker -->
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css"/>
    <!-- include polyfill first --->
    <script src="https://cdn.jsdelivr.net/npm/litepicker-polyfills-ie11/dist/index.js"></script>
    <!-- then include the Litepicker library --->
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <link rel="stylesheet" href="/static/css/litepicker.css">

    <!-- amchart xychart script -->
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

    <!-- amchart mapchart -->
    <script src="//cdn.amcharts.com/lib/4/maps.js"></script>
    <script src="//cdn.amcharts.com/lib/4/geodata/worldLow.js"></script>
    <!-- 아래의 naver 키를 넣으면 됩니다. -->
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=pky47i5x93"></script>
    <!-- 탭 누르면 데이터 콜 -->
    <script src="/static/js/tabs.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
</head>
<body>

<div class="container">
    <div class="header">

    </div>
    <br>
    <div class="row">
        <ul class="col" style="list-style:none;">
            <li class="col-lg"><p>
                <!-- single_daterangepicker -->
                <input id="litepicker" type="hidden"></input>
                <script src="/static/js/litepicker.js"></script>
            </p></li>

            <!--지도 표시 구역-->
            <li><div id="map" style="width:100%;height:400px;"></div></li>
            <li><div id="check" style="display:none;">당진수상</div></li>

        </ul>
        <div class="col-lg-8">
            <ul class="nav nav-tabs" style="list-style:none;" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" data-toggle="tab" id="temperature-tab" data-bs-target="#temperature" type="button" role="tab" aria-controls="pills-temperature" aria-selected="true">온도</a>

                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" data-toggle="tab" id="humidity-tab" data-bs-target="#humidity" type="button" role="tab" aria-controls="pills-humidity" aria-selected="false">습도</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" data-toggle="tab" id="hr-tab" data-bs-target="#hr" type="button" role="tab" aria-controls="pills-hr" aria-selected="false">일조</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" data-toggle="tab" id="cloud-tab" data-bs-target="#cloud" type="button" role="tab" aria-controls="pills-cloud" aria-selected="false">전운량</a>
                </li>
            </ul>
            <div class="tab-content">
                <ul class="tab-pane fade show active" style="list-style:none;">
                    <li id="temperature" role="tabpanel" aria-labelledby="pills-temperature-tab">
                        <div class="chart" id="xychart_1" style="height: 350px;"></div>
                    </li>
                    <li id="humidity" role="tabpanel" aria-labelledby="pills-humidity-tab">
                        <h3>태양광</h3>
                        <div class="chart" id="xychart_2" style="height: 350px;"></div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 임시 -->
        <input type="button" id="execute" value="execute">
        <script>
            $('#execute').click(function(){
                var time = $('#litepicker').val();
                start = time.substr(0, 10)
                end = time.substr(13, 10)
                var location = $('#check')[0].innerHTML;
                var column = document.getElementsByClassName("active")[0].innerText;
                var postdata = {
                    'start':start, 'end':end, 'time':time, 'location':location, 'column':column
                }
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("ajax")}}',
                    data: JSON.stringify(postdata),
                    dataType : 'JSON',
                    contentType: "application/json",
                    success: function(data){
                        console.log(data)
                        console.log("success")
                        console.log("start:", start)
                        console.log("end:", end)
                        console.log("location:", location)
                        console.log("column:", column)

                        var result = [];
                        var energy_result = [];

                        var chart_data = data.chart_data
                        var energy_data = data.energy_chart_data

                        for(var i in chart_data)
                            chart_data[i]["date"] = new Date(chart_data[i]["date"])
                            result.push(chart_data[i]);
                        for(var i in energy_data)
                            energy_data[i]["date"] = new Date(energy_data[i]["date"])
                            energy_result.push(energy_data[i]);

                        am4core.useTheme(am4themes_animated);
                        // Themes end

                        var chart = am4core.create("xychart_1", am4charts.XYChart);
                        var energy_chart = am4core.create("xychart_2", am4charts.XYChart);

                        chart.hiddenState.properties.opacity = 0; // this creates initial fade-in
                        energy_chart.hiddenState.properties.opacity = 0;
                        // request data

                        console.log(chart_data)

                        chart.data = chart_data;
                        energy_chart.data = energy_data;

                        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
                        var energy_dateAxis = energy_chart.xAxes.push(new am4charts.DateAxis());

                        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
                        var energy_valueAxis = energy_chart.yAxes.push(new am4charts.ValueAxis());

                        valueAxis.tooltip.disabled = true;
                        energy_valueAxis.tooltip.disabled = true;

                        var series = chart.series.push(new am4charts.LineSeries());
                        series.dataFields.dateX = "date";
                        series.dataFields.openValueY = "open";
                        series.dataFields.valueY = "close";
                        series.tooltipText = "open: {openValueY.value} close: {valueY.value}";
                        series.sequencedInterpolation = true;
                        series.fillOpacity = 0.3;
                        series.defaultState.transitionDuration = 1000;
                        series.tensionX = 0.8;

                        var energy_series = energy_chart.series.push(new am4charts.LineSeries());
                        energy_series.dataFields.dateX = "date";
                        energy_series.dataFields.openValueY = "open";
                        energy_series.dataFields.valueY = "close";
                        energy_series.tooltipText = "open: {openValueY.value} close: {valueY.value}";
                        energy_series.sequencedInterpolation = true;
                        energy_series.fillOpacity = 0.3;
                        energy_series.defaultState.transitionDuration = 1000;
                        energy_series.tensionX = 0.8;

                        var series2 = chart.series.push(new am4charts.LineSeries());
                        series2.dataFields.dateX = "date";
                        series2.dataFields.valueY = "open";
                        series2.sequencedInterpolation = true;
                        series2.defaultState.transitionDuration = 1500;
                        series2.stroke = chart.colors.getIndex(6);
                        series2.tensionX = 0.8;

                        var energy_series2 = energy_chart.series.push(new am4charts.LineSeries());
                        energy_series2.dataFields.dateX = "date";
                        energy_series2.dataFields.valueY = "open";
                        energy_series2.sequencedInterpolation = true;
                        energy_series2.defaultState.transitionDuration = 1500;
                        energy_series2.stroke = chart.colors.getIndex(6);
                        energy_series2.tensionX = 0.8;

                        chart.cursor = new am4charts.XYCursor();
                        chart.cursor.xAxis = dateAxis;
                        chart.scrollbarX = new am4core.Scrollbar();

                        energy_chart.cursor = new am4charts.XYCursor();
                        energy_chart.cursor.xAxis = dateAxis;
                        energy_chart.scrollbarX = new am4core.Scrollbar();
                    }
                })
            });

        </script>
    </div>
</div>
<script src="/static/js/map.js"></script>
</body>
</html>